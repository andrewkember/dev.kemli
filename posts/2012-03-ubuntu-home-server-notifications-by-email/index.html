<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Ubuntu home server: Notifications by email | Andrew Kember</title><meta name=keywords content><meta name=description content="This walkthrough tells you how to provide an email service to daemons on a home server so that it can send emails to a server admin&rsquo;s Gmail account.
Key: Actions look like this, results look like this and commands you enter on a terminal look like this. Replace [my_username] with your login on this server e.g. andrew. Replace [external_FQDN] with the domain name that you use to access your server from outside your local network."><meta name=author content="AK"><link rel=canonical href=https://blog.kember.net/posts/2012-03-ubuntu-home-server-notifications-by-email/><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.kember.net/static/images-header/ak-logo-2021-black-filled-optimised.svg><link rel=icon type=image/png sizes=16x16 href=https://blog.kember.net/static/images-header/ak-logo-2021-black-filled-optimised.svg><link rel=icon type=image/png sizes=32x32 href=https://blog.kember.net/static/images-header/ak-logo-2021-black-filled-optimised.svg><link rel=apple-touch-icon href=https://blog.kember.net/static/images-header/ak-logo-2021-black-filled-optimised.svg><link rel=mask-icon href=https://blog.kember.net/static/images-header/ak-logo-2021-black-filled-optimised.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.112.3"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Ubuntu home server: Notifications by email"><meta property="og:description" content="This walkthrough tells you how to provide an email service to daemons on a home server so that it can send emails to a server admin&rsquo;s Gmail account.
Key: Actions look like this, results look like this and commands you enter on a terminal look like this. Replace [my_username] with your login on this server e.g. andrew. Replace [external_FQDN] with the domain name that you use to access your server from outside your local network."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.kember.net/posts/2012-03-ubuntu-home-server-notifications-by-email/"><meta property="og:image" content="https://blog.kember.net/static/images-header/ak-logo-2021-black-filled-optimised.svg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2012-03-16T19:28:08+00:00"><meta property="article:modified_time" content="2012-03-16T19:28:08+00:00"><meta property="og:site_name" content="Andrew Kember"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.kember.net/static/images-header/ak-logo-2021-black-filled-optimised.svg"><meta name=twitter:title content="Ubuntu home server: Notifications by email"><meta name=twitter:description content="This walkthrough tells you how to provide an email service to daemons on a home server so that it can send emails to a server admin&rsquo;s Gmail account.
Key: Actions look like this, results look like this and commands you enter on a terminal look like this. Replace [my_username] with your login on this server e.g. andrew. Replace [external_FQDN] with the domain name that you use to access your server from outside your local network."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.kember.net/posts/"},{"@type":"ListItem","position":2,"name":"Ubuntu home server: Notifications by email","item":"https://blog.kember.net/posts/2012-03-ubuntu-home-server-notifications-by-email/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Ubuntu home server: Notifications by email","name":"Ubuntu home server: Notifications by email","description":"This walkthrough tells you how to provide an email service to daemons on a home server so that it can send emails to a server admin\u0026rsquo;s Gmail account.\nKey: Actions look like this, results look like this and commands you enter on a terminal look like this. Replace [my_username] with your login on this server e.g. andrew. Replace [external_FQDN] with the domain name that you use to access your server from outside your local network.","keywords":[],"articleBody":"This walkthrough tells you how to provide an email service to daemons on a home server so that it can send emails to a server admin’s Gmail account.\nKey: Actions look like this, results look like this and commands you enter on a terminal look like this. Replace [my_username] with your login on this server e.g. andrew. Replace [external_FQDN] with the domain name that you use to access your server from outside your local network. (FQDN is Fully Qualified Domain Name.) Replace [gmail address] with your normal email address. This should work just as well for non-gmail addresses, but it’s a useful distinction to show we’ll be sending mail outside our local network.\nPre-requisites Computer running Ubuntu (This was done on 10.04, but it’s fairly standard stuff) Domain name and DNS provider who can make this work - e.g. dyn.com sudo aptitude install postfix Postfix installs Postfix starts its configuration gui\nSelect defaults for:\nGeneral type of mail configuration System mail name sudo dpkg-reconfigure postfix Postfix starts its configuration gui\nSelect the following options:\nGeneral type of mail configuration: Internet Site System mail name: [external_FQDN] Root and postmaster mail recipient: [my_username] Other destinations to accept mail for (blank for none): localhost.[external_FQDN], localhost Force synchronous updates on mail queue?: No Local networks: 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128 [internal CIDR block, e.g. 192.168.0.0/24] Mailbox size limit (bytes): 0 Local address extension character: + Internet protocols to use: all Configure Postfix for SMTP-AUTH using Dovecot SASL sudo postconf -e 'smtpd_sasl_type = dovecot' sudo postconf -e 'smtpd_sasl_path = private/auth-client' sudo postconf -e 'smtpd_sasl_local_domain =' sudo postconf -e 'smtpd_sasl_security_options = noanonymous' sudo postconf -e 'broken_sasl_auth_clients = yes' sudo postconf -e 'smtpd_sasl_auth_enable = yes' sudo postconf -e 'smtpd_recipient_restrictions = permit_sasl_authenticated,permit_mynetworks,reject_unauth_destination' sudo postconf -e 'inet_interfaces = all' Postfix is configured silently - there is no output from these commands unless there’s a problem.\nGenerate the keys for the Certificate Signing Request (CSR) openssl genrsa -des3 -out server.key 1024 Enter passphrase when prompted server.key file is created in your current working directory.\nNow create the insecure key (no passphrase):\nopenssl rsa -in server.key -out server.key.insecure Enter passphrase when prompted server.key.insecure file is created in your current working directory.\nName the key files appropriately:\nmv server.key server.key.secure mv server.key.insecure server.key server.key.secure and server.key files are present in your current working directory.\nCreate the CSR using the insecure key:\nopenssl req -new -key server.key -out server.csr In the next step, you’ll fill in some details. The only important option is the Common Name, which should be the FQDN of the server. This is slightly different to the advice on Wikipedia which indicates that the CN(Common Name) is used as part of the DN(Distinguished Name).\nFill in some details about: Country Name; State or Province Name; Locality Name; Organization Name; Organizational Unit Name; Common Name; Email address.\nWhen prompted for the following optional attributes, leave them blank: A challenge password; An optional company name.\nserver.csr file is create in your current working directory.\nCreate a self-signed certificate and install it Note that this certificate will be valid from now until an end date determined by the number after the -days option.\nopenssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt sudo cp server.crt /etc/ssl/certs sudo cp server.key /etc/ssl/private Configure Postfix to provide TLS encryption for incoming and outgoing mail sudo postconf -e 'smtpd_tls_auth_only = no' sudo postconf -e 'smtp_tls_security_level = may' sudo postconf -e 'smtpd_tls_security_level = may' sudo postconf -e 'smtp_tls_note_starttls_offer = yes' sudo postconf -e 'smtpd_tls_key_file = /etc/ssl/private/server.key' sudo postconf -e 'smtpd_tls_cert_file = /etc/ssl/certs/server.crt' sudo postconf -e 'smtpd_tls_loglevel = 1' sudo postconf -e 'smtpd_tls_received_header = yes' sudo postconf -e 'smtpd_tls_session_cache_timeout = 3600s' sudo postconf -e 'tls_random_source = dev:/dev/urandom' sudo postconf -e 'myhostname = [external_FQDN]' Now restart postfix:\nsudo /etc/init.d/postfix restart Postfix should restart with no errors\nConfiguring SASL (Simple Authentication and Security Layer) sudo apt-get install dovecot-common Dovecot will install.\nEdit /etc/dovecot/dovecot.conf as root (e.g. sudoedit /etc/dovecot/dovecot.conf\nOn line 1116, or thereabouts, uncomment the socket listen option and modify the section so it looks like this:\nsocket listen { #master { # Master socket provides access to userdb information. It's typically # used to give Dovecot's local delivery agent access to userdb so it # can find mailbox locations. #path = /var/run/dovecot/auth-master #mode = 0600 # Default user/group is the one who started dovecot-auth (root) #user = #group = #} client { # The client socket is generally safe to export to everyone. Typical use # is to export it to your SMTP server so it can do SMTP AUTH lookups # using it. path = /var/spool/postfix/private/auth-client mode = 0660 user = postfix group = postfix } } Now restart Dovecot\nsudo /etc/init.d/dovecot restart Setting up Aliases Edit /etc/aliases as root (e.g. sudoedit /etc/aliases) to add your gmail address. Once you’ve finished, it should look like this:\n# See man 5 aliases for format postmaster: root root: [gmail address] [my_username]: [gmail address] Testing Lets see if we can connect to our postfix instance with telnet.\ntelnet localhost 25 … results in the following:\nTrying ::1... Connected to localhost. Escape character is '^]'. 220 [external_FQDN] ESMTP Postfix (Ubuntu) Type the following command into the telnet session:\nehlo [external_FQDN] The output should include the following lines (and probably a bunch of others):\n250-[external_FQDN] 250-STARTTLS 250-AUTH PLAIN 250-AUTH=PLAIN 250-8BITMIME Let’s follow that up by sending an email directly from the telnet session.\nType the following commands into the telnet session:\nmail from: root@localhost rcpt to: [my_username]@localhost data Subject: My first mail on Postfix Hello, Are you there, Charlie Bear? Regards, Me . (I.e. Type the . [dot] in a new Line and press Enter) quit Postfix will acknowledge each command with a message ending in ‘Ok’ (except when you type the message contents). The output should look a bit like this:\n250 2.0.0 Ok: queued as 402DA9FCD4 quit 221 2.0.0 Bye Connection closed by foreign host. Wait for it… Okay - now check your email. If all has gone well, you’ve got an email from yourself sitting in your inbox.\nThese instructions were pieced together from Postfix: Ubuntu server guide and Certificates: Ubuntu server guide.\n","wordCount":"1012","inLanguage":"en","datePublished":"2012-03-16T19:28:08Z","dateModified":"2012-03-16T19:28:08Z","author":{"@type":"Person","name":"AK"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.kember.net/posts/2012-03-ubuntu-home-server-notifications-by-email/"},"publisher":{"@type":"Organization","name":"Andrew Kember","logo":{"@type":"ImageObject","url":"https://blog.kember.net/static/images-header/ak-logo-2021-black-filled-optimised.svg"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.kember.net/ accesskey=h title="Andrew Kember (Alt + H)"><svg xmlns="http://www.w3.org/2000/svg" width="55" height="55" viewBox="0 0 202.02 202.02" style="vertical-align:middle"><g transform="translate(-3.65 -3.93)"><circle style="opacity:1;fill:none;fill-opacity:1;stroke:currentColor;stroke-width:16;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" cx="104.66" cy="104.94" r="93.01"/></g><g style="display:inline;fill:currentColor;fill-opacity:1;stroke:none"><path d="m242.73 334.58 28.99-2.5-.77 48q-.19 4.8.2 8.45.38 3.26 1.15 5.76.76 2.5 2.5 2.5 1.53.0 2.49-1.93 1.15-2.1 1.73-4.6.76-2.88.96-6.72h8.25q.58 2.68.58 5.95.0 2.69-.58 6.53-.57 3.84-2.5 8.25-1.53 4.61-3.83 7.68-2.12 3.07-4.8 5-2.5 1.91-5.19 2.87t-5.18 1.54q-2.69.38-6.91-1.34-4.04-1.73-8.07-4.04-4.8-2.68-9.98-6.14-4.42 2.88-7.87 5.18-3.08 2.12-6.15 4.04-2.88 1.92-4.03 2.3-.96.38-4.42 1.34-3.45.96-8.44.77-5 0-11.14-2.3-6.14-2.11-12.29-8.07-6.33-6.14-9.02-13.24-2.69-7.3-3.65-13.44-.96-7.3.0-14.4.38-8.26 2.69-15.94 2.11-6.53 6.33-13.44 4.42-6.91 12.48-11.33 8.07-4.41 15.94-3.84 8.06.39 14.4 2.5 7.49 2.5 14.4 7.3zm-19.01 12.28q-5.57.0-9.4 6.15-3.85 6.14-3.85 18.24.0 12.48 3.84 19.2 3.84 6.72 9.41 6.72t9.8-6.72q4.22-6.72 4.22-19.2.0-12.1-4.23-18.24-4.22-6.15-9.79-6.15z" style="font-size:192px" transform="translate(-82.94 -145.69) scale(.6706)" aria-label="a"/><path d="M217.2 420.6h-42.63v-16.14q3.84.2 6.72-.57 2.5-.77 4.41-2.69 2.12-2.11 1.73-6.34v-19.39q.2-6.91.2-14.78.19-8.07.19-16.13.19-18.82.38-41.28l29-12.1v74.12q2.87.19 5.75-.2 2.5-.38 5-.96 2.49-.57 4.41-2.1 3.07-3.08 1.92-6.34-1.15-3.46-8.26-3.46l.77-11.14 43.2-.96q1.73 10.37.77 18.82-.38 3.65-1.54 7.1-.96 3.46-2.88 6.34t-4.99 4.8-7.3 2.3l29 40.13-38.6.96-19.39-23.23q-2.3-1.54-4.03-1.92-1.53-.38-2.69.38-1.15.77-1.15 3.84z" style="font-size:192px" transform="translate(-21.52 -145.16) scale(.6706)" aria-label="k"/></g></svg></a></div><ul id=menu><li><a href=https://blog.kember.net/about/ title=About><span>About</span></a></li><li><a href=https://blog.kember.net/commonplace/ title=Commonplace><span>Commonplace</span></a></li><li><a href=https://blog.kember.net/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><span class=logo-switches>&nbsp;|
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.kember.net/>Home</a>&nbsp;»&nbsp;<a href=https://blog.kember.net/posts/>Posts</a></div><h1 class=post-title>Ubuntu home server: Notifications by email</h1><div class=post-meta><span title='2012-03-16 19:28:08 +0000 UTC'>March 16, 2012</span>&nbsp;·&nbsp;AK</div></header><div class=post-content><p>This walkthrough tells you how to provide an email service to daemons on a home server so that it can send emails to a server admin&rsquo;s Gmail account.</p><p>Key: <strong>Actions look like this</strong>, <em>results look like this</em> and <code>commands you enter on a terminal look like this</code>. Replace <code>[my_username]</code> with your login on this server e.g. <code>andrew</code>. Replace <code>[external_FQDN]</code> with the domain name that you use to access your server from outside your local network. (FQDN is Fully Qualified Domain Name.) Replace <code>[gmail address]</code> with your normal email address. This should work just as well for non-gmail addresses, but it&rsquo;s a useful distinction to show we&rsquo;ll be sending mail outside our local network.</p><h3 id=pre-requisites>Pre-requisites<a hidden class=anchor aria-hidden=true href=#pre-requisites>#</a></h3><ul><li>Computer running Ubuntu (This was done on 10.04, but it&rsquo;s fairly standard stuff)</li><li>Domain name and DNS provider who can make this work - e.g. dyn.com</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo aptitude install postfix
</span></span></code></pre></div><p><em>Postfix installs</em><br><em>Postfix starts its configuration gui</em></p><p><strong>Select defaults for:</strong></p><ul><li>General type of mail configuration</li><li>System mail name</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo dpkg-reconfigure postfix
</span></span></code></pre></div><p><em>Postfix starts its configuration gui</em></p><p><strong>Select the following options:</strong></p><ul><li>General type of mail configuration: <code>Internet Site</code></li><li>System mail name: <code>[external_FQDN]</code></li><li>Root and postmaster mail recipient: <code>[my_username]</code></li><li>Other destinations to accept mail for (blank for none): <code>localhost.[external_FQDN], localhost</code></li><li>Force synchronous updates on mail queue?: <code>No</code></li><li>Local networks: <code>127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128 [internal CIDR block, e.g. 192.168.0.0/24]</code></li><li>Mailbox size limit (bytes): <code>0</code></li><li>Local address extension character: <code>+</code></li><li>Internet protocols to use: <code>all</code></li></ul><h3 id=configure-postfix-for-smtp-auth-using-dovecot-sasl>Configure Postfix for SMTP-AUTH using Dovecot SASL<a hidden class=anchor aria-hidden=true href=#configure-postfix-for-smtp-auth-using-dovecot-sasl>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo postconf -e <span style=color:#e6db74>&#39;smtpd_sasl_type = dovecot&#39;</span>
</span></span><span style=display:flex><span>sudo postconf -e <span style=color:#e6db74>&#39;smtpd_sasl_path = private/auth-client&#39;</span>
</span></span><span style=display:flex><span>sudo postconf -e <span style=color:#e6db74>&#39;smtpd_sasl_local_domain =&#39;</span>
</span></span><span style=display:flex><span>sudo postconf -e <span style=color:#e6db74>&#39;smtpd_sasl_security_options = noanonymous&#39;</span>
</span></span><span style=display:flex><span>sudo postconf -e <span style=color:#e6db74>&#39;broken_sasl_auth_clients = yes&#39;</span>
</span></span><span style=display:flex><span>sudo postconf -e <span style=color:#e6db74>&#39;smtpd_sasl_auth_enable = yes&#39;</span>
</span></span><span style=display:flex><span>sudo postconf -e <span style=color:#e6db74>&#39;smtpd_recipient_restrictions = permit_sasl_authenticated,permit_mynetworks,reject_unauth_destination&#39;</span>
</span></span><span style=display:flex><span>sudo postconf -e <span style=color:#e6db74>&#39;inet_interfaces = all&#39;</span>
</span></span></code></pre></div><p><em>Postfix is configured silently - there is no output from these commands unless there&rsquo;s a problem.</em></p><h3 id=generate-the-keys-for-the-certificate-signing-request-csr>Generate the keys for the Certificate Signing Request (CSR)<a hidden class=anchor aria-hidden=true href=#generate-the-keys-for-the-certificate-signing-request-csr>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>openssl genrsa -des3 -out server.key <span style=color:#ae81ff>1024</span>
</span></span></code></pre></div><p><strong>Enter passphrase when prompted</strong><br><em><code>server.key</code> file is created in your current working directory.</em></p><p>Now create the insecure key (no passphrase):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>openssl rsa -in server.key -out server.key.insecure
</span></span></code></pre></div><p><strong>Enter passphrase when prompted</strong><br><em><code>server.key.insecure</code> file is created in your current working directory.</em></p><p>Name the key files appropriately:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mv server.key server.key.secure
</span></span><span style=display:flex><span>mv server.key.insecure server.key
</span></span></code></pre></div><p><em><code>server.key.secure</code> and <code>server.key</code> files are present in your current working directory.</em></p><p>Create the CSR using the insecure key:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>openssl req -new -key server.key -out server.csr
</span></span></code></pre></div><p>In the next step, you&rsquo;ll fill in some details. The only important option is the Common Name, which should be the FQDN of the server. This is slightly different to the <a href=https://en.wikipedia.org/wiki/Certificate_signing_request>advice</a> on Wikipedia which indicates that the CN(Common Name) is used as part of the DN(Distinguished Name).</p><p><strong>Fill in some details about:</strong> Country Name; State or Province Name; Locality Name; Organization Name; Organizational Unit Name; Common Name; Email address.</p><p><strong>When prompted for the following optional attributes, leave them blank:</strong> A challenge password; An optional company name.</p><p><em><code>server.csr</code> file is create in your current working directory.</em></p><h3 id=create-a-self-signed-certificate-and-install-it>Create a self-signed certificate and install it<a hidden class=anchor aria-hidden=true href=#create-a-self-signed-certificate-and-install-it>#</a></h3><p>Note that this certificate will be valid from now until an end date determined by the number after the <code>-days</code> option.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>openssl x509 -req -days <span style=color:#ae81ff>365</span> -in server.csr -signkey server.key -out server.crt
</span></span><span style=display:flex><span>sudo cp server.crt /etc/ssl/certs
</span></span><span style=display:flex><span>sudo cp server.key /etc/ssl/private
</span></span></code></pre></div><h3 id=configure-postfix-to-provide-tls-encryption-for-incoming-and-outgoing-mail>Configure Postfix to provide TLS encryption for incoming and outgoing mail<a hidden class=anchor aria-hidden=true href=#configure-postfix-to-provide-tls-encryption-for-incoming-and-outgoing-mail>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo postconf -e <span style=color:#e6db74>&#39;smtpd_tls_auth_only = no&#39;</span>
</span></span><span style=display:flex><span>sudo postconf -e <span style=color:#e6db74>&#39;smtp_tls_security_level = may&#39;</span>
</span></span><span style=display:flex><span>sudo postconf -e <span style=color:#e6db74>&#39;smtpd_tls_security_level = may&#39;</span>
</span></span><span style=display:flex><span>sudo postconf -e <span style=color:#e6db74>&#39;smtp_tls_note_starttls_offer = yes&#39;</span>
</span></span><span style=display:flex><span>sudo postconf -e <span style=color:#e6db74>&#39;smtpd_tls_key_file = /etc/ssl/private/server.key&#39;</span>
</span></span><span style=display:flex><span>sudo postconf -e <span style=color:#e6db74>&#39;smtpd_tls_cert_file = /etc/ssl/certs/server.crt&#39;</span>
</span></span><span style=display:flex><span>sudo postconf -e <span style=color:#e6db74>&#39;smtpd_tls_loglevel = 1&#39;</span>
</span></span><span style=display:flex><span>sudo postconf -e <span style=color:#e6db74>&#39;smtpd_tls_received_header = yes&#39;</span>
</span></span><span style=display:flex><span>sudo postconf -e <span style=color:#e6db74>&#39;smtpd_tls_session_cache_timeout = 3600s&#39;</span>
</span></span><span style=display:flex><span>sudo postconf -e <span style=color:#e6db74>&#39;tls_random_source = dev:/dev/urandom&#39;</span>
</span></span><span style=display:flex><span>sudo postconf -e <span style=color:#e6db74>&#39;myhostname = [external_FQDN]&#39;</span>
</span></span></code></pre></div><p>Now restart postfix:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo /etc/init.d/postfix restart
</span></span></code></pre></div><p><em>Postfix should restart with no errors</em></p><h3 id=configuring-sasl-simple-authentication-and-security-layer>Configuring SASL (Simple Authentication and Security Layer)<a hidden class=anchor aria-hidden=true href=#configuring-sasl-simple-authentication-and-security-layer>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get install dovecot-common
</span></span></code></pre></div><p><em>Dovecot will install.</em></p><p>Edit <code>/etc/dovecot/dovecot.conf</code> as root (e.g. <code>sudoedit /etc/dovecot/dovecot.conf</code></p><p>On line 1116, or thereabouts, <strong>uncomment the socket listen option and modify the section so it looks like this</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> socket listen <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#master {</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Master socket provides access to userdb information. It&#39;s typically</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># used to give Dovecot&#39;s local delivery agent access to userdb so it</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># can find mailbox locations.</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#path = /var/run/dovecot/auth-master</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#mode = 0600</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Default user/group is the one who started dovecot-auth (root)</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#user = </span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#group = </span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#}</span>
</span></span><span style=display:flex><span>    client <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># The client socket is generally safe to export to everyone. Typical use</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># is to export it to your SMTP server so it can do SMTP AUTH lookups</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># using it.</span>
</span></span><span style=display:flex><span>      path <span style=color:#f92672>=</span> /var/spool/postfix/private/auth-client
</span></span><span style=display:flex><span>      mode <span style=color:#f92672>=</span> <span style=color:#ae81ff>0660</span>
</span></span><span style=display:flex><span>      user <span style=color:#f92672>=</span> postfix
</span></span><span style=display:flex><span>      group <span style=color:#f92672>=</span> postfix
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Now restart Dovecot</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo /etc/init.d/dovecot restart
</span></span></code></pre></div><h3 id=setting-up-aliases>Setting up Aliases<a hidden class=anchor aria-hidden=true href=#setting-up-aliases>#</a></h3><p>Edit <code>/etc/aliases</code> as root (e.g. <code>sudoedit /etc/aliases</code>) to add your gmail address. Once you&rsquo;ve finished, it should look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># See man 5 aliases for format</span>
</span></span><span style=display:flex><span>postmaster:    root
</span></span><span style=display:flex><span>root:          <span style=color:#f92672>[</span>gmail address<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>my_username<span style=color:#f92672>]</span>: <span style=color:#f92672>[</span>gmail address<span style=color:#f92672>]</span>
</span></span></code></pre></div><h3 id=testing>Testing<a hidden class=anchor aria-hidden=true href=#testing>#</a></h3><p>Lets see if we can connect to our postfix instance with telnet.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>telnet localhost <span style=color:#ae81ff>25</span>
</span></span></code></pre></div><p><em>&mldr; results in the following:</em></p><pre tabindex=0><code class=language-bsah data-lang=bsah>Trying ::1...
Connected to localhost.
Escape character is &#39;^]&#39;.
220 [external_FQDN] ESMTP Postfix (Ubuntu)
</code></pre><p><strong>Type the following command into the telnet session:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ehlo <span style=color:#f92672>[</span>external_FQDN<span style=color:#f92672>]</span>
</span></span></code></pre></div><p><em>The output should include the following lines (and probably a bunch of others):</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>250-<span style=color:#f92672>[</span>external_FQDN<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>250-STARTTLS
</span></span><span style=display:flex><span>250-AUTH PLAIN
</span></span><span style=display:flex><span>250-AUTH<span style=color:#f92672>=</span>PLAIN
</span></span><span style=display:flex><span>250-8BITMIME
</span></span></code></pre></div><p>Let&rsquo;s follow that up by sending an email directly from the telnet session.</p><p><strong>Type the following commands into the telnet session:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mail from: root@localhost
</span></span><span style=display:flex><span>rcpt to: <span style=color:#f92672>[</span>my_username<span style=color:#f92672>]</span>@localhost
</span></span><span style=display:flex><span>data
</span></span><span style=display:flex><span>Subject: My first mail on Postfix
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Hello,
</span></span><span style=display:flex><span>Are you there, Charlie Bear?
</span></span><span style=display:flex><span>Regards,
</span></span><span style=display:flex><span>Me
</span></span><span style=display:flex><span>. <span style=color:#f92672>(</span>I.e. Type the . <span style=color:#f92672>[</span>dot<span style=color:#f92672>]</span> in a new Line and press Enter<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>quit
</span></span></code></pre></div><p><em>Postfix will acknowledge each command with a message ending in &lsquo;Ok&rsquo; (except when you type the message contents). The output should look a bit like this:</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ae81ff>250</span> 2.0.0 Ok: queued as 402DA9FCD4
</span></span><span style=display:flex><span>quit
</span></span><span style=display:flex><span><span style=color:#ae81ff>221</span> 2.0.0 Bye
</span></span><span style=display:flex><span>Connection closed by foreign host.
</span></span></code></pre></div><p>Wait for it&mldr; Okay - now <strong>check your email</strong>. If all has gone well, <em>you&rsquo;ve got an email from yourself sitting in your inbox</em>.</p><p>These instructions were pieced together from <a href=https://help.ubuntu.com/10.04/serverguide/C/postfix.html><del>Postfix: Ubuntu server guide</del></a> and <a href=https://help.ubuntu.com/10.04/serverguide/C/certificates-and-security.html><del>Certificates: Ubuntu server guide</del></a>.</p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://blog.kember.net/posts/2012-04-decorators-a-neat-way-to-modify-functions/><span class=title>« Prev Page</span><br><span>Decorators: A neat way to modify functions</span></a>
<a class=next href=https://blog.kember.net/posts/2010-07-sansa-clip-volume-problem/><span class=title>Next Page »</span><br><span>Sansa clip volume problem</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.kember.net/>Andrew Kember</a></span>
<span>&mdash; Obfuscation is Easy</span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>