<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Raspberry Pi temperature monitor | dev</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="I want to monitor the temperature in all the rooms in my house.
Why? I like comfort and efficiency. If I know the temperature of each room in my house, with periodic measurements twenty four hours a day, I can tune the heating system to be comfortable and energy efficient. Because I&rsquo;m a bit of a geek, this is classed as &lsquo;fun&rsquo; which means I don&rsquo;t need to offset the cost of the project against my heating bill."><meta name=generator content="Hugo 0.81.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link href=/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css rel=stylesheet><meta property="og:title" content="Raspberry Pi temperature monitor"><meta property="og:description" content="I want to monitor the temperature in all the rooms in my house.
Why? I like comfort and efficiency. If I know the temperature of each room in my house, with periodic measurements twenty four hours a day, I can tune the heating system to be comfortable and energy efficient. Because I&rsquo;m a bit of a geek, this is classed as &lsquo;fun&rsquo; which means I don&rsquo;t need to offset the cost of the project against my heating bill."><meta property="og:type" content="article"><meta property="og:url" content="https://dev.kem.li/posts/2021-03-pi-thing/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-03-13T19:00:00+00:00"><meta property="article:modified_time" content="2021-03-13T19:00:00+00:00"><meta itemprop=name content="Raspberry Pi temperature monitor"><meta itemprop=description content="I want to monitor the temperature in all the rooms in my house.
Why? I like comfort and efficiency. If I know the temperature of each room in my house, with periodic measurements twenty four hours a day, I can tune the heating system to be comfortable and energy efficient. Because I&rsquo;m a bit of a geek, this is classed as &lsquo;fun&rsquo; which means I don&rsquo;t need to offset the cost of the project against my heating bill."><meta itemprop=datePublished content="2021-03-13T19:00:00+00:00"><meta itemprop=dateModified content="2021-03-13T19:00:00+00:00"><meta itemprop=wordCount content="1731"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Raspberry Pi temperature monitor"><meta name=twitter:description content="I want to monitor the temperature in all the rooms in my house.
Why? I like comfort and efficiency. If I know the temperature of each room in my house, with periodic measurements twenty four hours a day, I can tune the heating system to be comfortable and energy efficient. Because I&rsquo;m a bit of a geek, this is classed as &lsquo;fun&rsquo; which means I don&rsquo;t need to offset the cost of the project against my heating bill."><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-0RZR8M66RS','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="ma0 avenir bg-near-white production"><header><div class=bg-near-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">dev</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/posts/ title="Posts page">Posts</a></li></ul><a href=https://twitter.com/andrewkember target=_blank class="link-transition twitter link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://www.linkedin.com/in/andrewkember/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://github.com/andrewkember target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class=mt3><a href="https://www.facebook.com/sharer.php?u=https://dev.kem.li/posts/2021-03-pi-thing/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a href="https://twitter.com/share?url=https://dev.kem.li/posts/2021-03-pi-thing/&text=Raspberry%20Pi%20temperature%20monitor" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://dev.kem.li/posts/2021-03-pi-thing/&title=Raspberry%20Pi%20temperature%20monitor" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 athelas mt3 mb1">Raspberry Pi temperature monitor</h1><time class="f6 mv4 dib tracked" datetime=2021-03-13T19:00:00Z>March 13, 2021</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>I want to monitor the temperature in all the rooms in my house.</p><p><strong>Why?</strong> I like comfort and efficiency. If I know the temperature of each room in my house, with periodic measurements twenty four hours a day, I can tune the heating system to be comfortable and energy efficient. Because I&rsquo;m a bit of a geek, this is classed as &lsquo;fun&rsquo; which means I don&rsquo;t need to offset the cost of the project against my heating bill.</p><p><strong>What?</strong> I want a way to have a log of the temperature in each room of my house at regular intervals without having to be there in person, or - for that matter - be awake.</p><p><strong>How?</strong> Well, that&rsquo;s the question, isn&rsquo;t it? My starting assumption is that I need a sensor in every room. This rules out a single smart thermostat which might learn my habits, but would be woefully under-informed about the temperatures across my house.</p><p>Contents:</p><ul><li><a href=#priorities>Priorities</a></li><li><a href=#purchases>Purchases</a></li><li><a href=#microsd-os-image>microSD OS image</a></li><li><a href=#first-boot>#First boot</a></li><li><a href=#configure-with-ansible>Configure with Ansible</a></li></ul><h1 id=priorities>Priorities</h1><p>I&rsquo;ve had lots of recommendations for good approaches. There are trade-offs to be made for each:</p><ul><li>Battery vs mains</li><li>Portability</li><li>Low maintenance</li></ul><p>Some applications need the freedom to put the sensors anywhere. My preference is to have a system that I maintain (in person) about once a year. I&rsquo;m happy to give up a power socket per room to get that, and have the sensor within reach of that power socket.</p><ul><li>Wifi vs bluetooth vs Z-Wave vs Zigbee vs ethernet</li><li>Dedicated device vs DIY mashup</li><li>Arduino vs Raspberry Pi</li><li>Afinity to my skills</li></ul><p>I&rsquo;ve done my time writing assembler and embedded C (for now, at least). I learnt both at university, and applied those skills in my first job after my degree. I&rsquo;ve helped write I2C libraries and (different job) an X10 module in Python. I think I&rsquo;ve got the apptitude to use any of those options. ￼But do I want to?</p><ul><li>Alignment to my areas of interest</li></ul><p>I&rsquo;m working in the wonderful world of DevOps, where Python and Ansible and Prometheus are regularly in the spotlight. I&rsquo;m a manager in my day-job, so I <em>don&rsquo;t</em> actually get to play with the toys (except spreadsheets). It&rsquo;d be cool to have a solution that uses those.</p><ul><li>Price per unit: Cheaper is better, as long as the fun-factor is maintained.</li><li>Development time: Quicker is better. There aren&rsquo;t many fun-project-hours in a given month.</li><li>Availablity of equipment: If it needs a lathe, a 3D printer or an underground network of tunnels, it&rsquo;s out.</li></ul><h2 id=arduino-approach>Arduino approach</h2><table><thead><tr><th>Cost</th><th>Thing</th></tr></thead><tbody><tr><td>£20</td><td>Arduino uno / £6 Arduino nano</td></tr><tr><td>£5</td><td>Real time clock board/Data logging shield</td></tr><tr><td>£6</td><td>Temperature sensor</td></tr><tr><td>£8</td><td>Bluetooth module??</td></tr></tbody></table><p>Total: £39 per unit. I reckon that component list wouldn&rsquo;t work - the nano and uno have different form factors, the bluetooth has to talk to &mldr; something, but it gives me a place to start. I&rsquo;ve heard I get a WiFi-enabled-Arduino-compatible board from China for cheaps. So that&rsquo;s an option.</p><h2 id=raspberry-pi-approach>Raspberry Pi approach</h2><table><thead><tr><th>Cost</th><th>Thing</th></tr></thead><tbody><tr><td>£10</td><td>Raspberry Pi Zero W</td></tr><tr><td>£4</td><td>DS18B20 temperature sensor</td></tr><tr><td>£0</td><td>4.7kohm resistor - free with sensor</td></tr><tr><td>£1</td><td>40 pin header</td></tr><tr><td>£6</td><td>USB PSU</td></tr><tr><td>£3</td><td>Case</td></tr><tr><td>£3</td><td>Shipping</td></tr></tbody></table><p>Total: £27 per unit</p><p>Blocker: I can order only one Raspberry Pi Zero W per customer? What madness is this?</p><p>I&rsquo;m going to give the Raspberry Pi route a try. It hits a lot of the sweet spots, and it&rsquo;ll be fun - even if I can&rsquo;t source 10 RPi Zero Ws because of the bizarre sales limits.</p><h1 id=purchases>Purchases</h1><p>Here&rsquo;s what I&rsquo;m starting out with.</p><p>Central control server:</p><ul><li>Raspberry Pi 4</li><li><a href=https://www.jeffgeerling.com/blog/2019/raspberry-pi-microsd-card-performance-comparison-2019>microSD card</a></li><li><a href=https://thepihut.com/products/flirc-raspberry-pi-4-case>Case</a></li><li>Pi 4 official power supply</li></ul><p>Temperature sensor pi:</p><ul><li>Waterproof DS18B20 Digital temperature sensor + extras</li><li>Raspberry Pi Zero W</li><li>microSD card</li><li>Case</li><li>Micro-USB power supply</li></ul><h1 id=microsd-os-image>microSD OS image</h1><p>The first order of business is to get a process for bootstrapping the Raspberry Pi Zeros.</p><h2 id=install-the-official-raspberry-pi-imager>Install the official Raspberry Pi Imager</h2><p>&mldr;from <a href=https://www.raspberrypi.org/software/>https://www.raspberrypi.org/software/</a>.</p><p>(You could use this zsh script I wrote to do that, but honestly it seems like a lot of trouble to go to.)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh>IMAGER<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/Applications/Raspberry Pi Imager.app&#34;</span>
<span style=color:#75715e># Install RPi imager software if it&#39;s not already available</span>
<span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> ! -a $IMAGER <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
    IMAGER_DOWNLOAD<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://downloads.raspberrypi.org/imager/imager_1.5.dmg&#34;</span>
    wget $IMAGER_DOWNLOAD
    DISKIMAGE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>hdiutil attach ./imager_1.5.dmg | grep <span style=color:#e6db74>&#39;Raspberry&#39;</span> | cut -f1<span style=color:#66d9ef>)</span>
    cp -R <span style=color:#e6db74>&#34;/Volumes/Raspberry Pi Imager/Raspberry Pi Imager.app&#34;</span> /Applications/
    hdiutil detach $DISKIMAGE
<span style=color:#66d9ef>fi</span>
</code></pre></div><h2 id=transfer-the-os-image-to-the-microsd-card>Transfer the OS image to the microSD card</h2><p><img src=/static/posts/2021-03-pi-thing-pi-imager.png alt="Raspberry Pi Imager"></p><ol><li>Open Raspberry Pi Imager</li><li>Plug in microSD card</li><li>Choose <code>Raspberry Pi OS Lite (32-bit)</code></li><li>Choose microSD card</li><li>CHoose Write</li><li>MacOS is likely to ask you for various permissions for the imager</li><li>The imaging unmounts the SD card, so unplug it and plug it in again</li></ol><h2 id=prepare-the-os-image-for-first-boot>Prepare the OS image for first boot</h2><p>The first boot will be headless (no keyboard/monitor) and wireless (i.e. I want it to connect to my Wifi with no further configuration nesessary). The Pi OS image checks for a few additional files in the /boot directory on first boot. That enables me to enable SSH and WiFi.</p><p>From a terminal, with the microSD card plugged back in&mldr;</p><p><code>cd /Volumes/boot</code></p><p>Enable SSH:</p><p><code>touch ssh</code></p><p>Enable and configure WiFi:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh>cat <span style=color:#e6db74>&lt;&lt; EOF &gt; wpa_supplicant.conf
</span><span style=color:#e6db74>ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
</span><span style=color:#e6db74>network={
</span><span style=color:#e6db74>    ssid=&#34;YOUR_SSID&#34;
</span><span style=color:#e6db74>    psk=&#34;YOUR_WIFI_PASSWORD&#34;
</span><span style=color:#e6db74>    key_mgmt=WPA-PSK
</span><span style=color:#e6db74>}
</span><span style=color:#e6db74>EOF</span>
</code></pre></div><p>Eject the microSD card safely using Finder, and unplug it.</p><h1 id=first-boot>#First boot</h1><ol><li>Assemble the Raspberry Pi Zero in the case</li><li>Insert the microSD card</li><li>Run <code>arp -a</code> to list the devices connected to your network</li><li>Plug the power supply into the wall and plug the lead into the microUSB connector (it&rsquo;s the one closest to the corner of the board).</li><li>Wait a minute or two for the Pi to boot</li><li>Run <code>arp -a</code> and spot the difference. The host name for me is <code>raspberrypi.myhomedomain</code></li></ol><h1 id=configure-with-ansible>Configure with Ansible</h1><p>There are a number of bootstrap tasks to perform that will let me connect to the Pi with Ansible in a consistent way.</p><ul><li>Create SSH keys</li><li>Create a new user</li><li>Enable SSH access for that user with that key and remove its password</li><li>Enable passwordless sudo for that user</li><li>Set the hostnmae</li><li>Clean up (delete) the default user</li></ul><p>Ideally, I&rsquo;d like to complete those tasks automatically with Ansible too, but I don&rsquo;t know how yet, so in the interim:</p><h2 id=create-pubic-private-keypair>Create pubic-private keypair</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh>$ ssh-keygen -t rsa -f ./rpi-key
Generating public/private rsa key pair.
Enter passphrase <span style=color:#f92672>(</span>empty <span style=color:#66d9ef>for</span> no passphrase<span style=color:#f92672>)</span>:
Enter same passphrase again:
Your identification has been saved in ./rpi-key.
Your public key has been saved in ./rpi-key.pub.
The key fingerprint is:
SHA256:JRdQyqJfuDglJ4r+SqsdFXIF8FlXSi9QAE3ZY2nHXnU ak@Ashpool
The key<span style=color:#960050;background-color:#1e0010>&#39;</span>s randomart image is:
+---<span style=color:#f92672>[</span>RSA 3072<span style=color:#f92672>]</span>----+
|  ..o<span style=color:#f92672>=</span>*<span style=color:#f92672>==</span>*+  .. E|
|   . +o<span style=color:#f92672>=</span>*+o..  . |
|  . <span style=color:#f92672>=</span> .o*++.     |
|   o o o <span style=color:#f92672>=</span>.      |
|    <span style=color:#f92672>=</span> + S        |
| . o B o         |
|..o o o          |
|o... .           |
|o++.             |
+----<span style=color:#f92672>[</span>SHA256<span style=color:#f92672>]</span>-----+

$ ls rpi-key*
rpi-key     rpi-key.pub

</code></pre></div><h2 id=log-in-using-ssh>Log in using SSH</h2><pre><code>$ ssh pi@raspberrypi.myhomedomain
The authenticity of host 'raspberrypi.myhomedomain (172.80.43.99)' can't be established.
ECDSA key fingerprint is SHA256:6ryJBtgVc6k1liVATfBBXnapErFLAArbhVhwoFu7aw0.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added 'raspberrypi.myhomedomain,172.80.43.99' (ECDSA) to the list of known hosts.
pi@raspberrypi.myhomedomain's password:
Linux raspberrypi 5.4.83+ #1379 Mon Dec 14 13:06:05 GMT 2020 armv6l

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.

SSH is enabled and the default password for the 'pi' user has not been changed.
This is a security risk - please login as the 'pi' user and type 'passwd' to set a new password.

pi@raspberrypi:~ $
</code></pre><h2 id=create-a-new-user>Create a new user</h2><pre><code>pi@raspberrypi:~ $ sudo adduser robot
Adding user `robot' ...
Adding new group `robot' (1001) ...
Adding new user `robot' (1001) with group `robot' ...
Creating home directory `/home/robot' ...
Copying files from `/etc/skel' ...
New password:
Retype new password:
passwd: password updated successfully
Changing the user information for robot
Enter the new value, or press ENTER for the default
	Full Name []: Ansible Robot
	Room Number []:
	Work Phone []:
	Home Phone []:
	Other []:
Is the information correct? [Y/n] y
pi@raspberrypi:~ $
</code></pre><h2 id=give-that-user-passwordless-sudo-access>Give that user passwordless sudo access</h2><pre><code>pi@raspberrypi:~ $ sudo adduser robot sudo
Adding user `robot' to group `sudo' ...
Adding user robot to group sudo
Done.
pi@raspberrypi:~ $

sudo visudo /etc/sudoers.d/010_robot-nopasswd
</code></pre><p>Enter <code>robot ALL=(ALL) NOPASSWD: ALL</code>
Save and quit the editor
Test:</p><pre><code>robot@raspberrypi:~ $ sudo whoami
root
</code></pre><h2 id=remove-password-for-user>Remove password for user</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh>robot@raspberrypi:~ $ sudo passwd robot -d
passwd: password expiry information changed.
robot@raspberrypi:~ $
</code></pre></div><h2 id=give-robot-user-same-groups-as-pi>Give robot user same groups as pi</h2><pre><code>sudo cat /etc/group | grep pi

sudo usermod -G adm,dialout,cdrom,audio,video,plugdev,games,users,input,netdev robot
</code></pre><h2 id=remove-default-user-pi>Remove default user &lsquo;pi&rsquo;</h2><pre><code>robot@raspberrypi:~ $ sudo deluser --remove-home pi
Looking for files to backup/remove ...
Removing files ...
Removing user `pi' ...
Warning: group `pi' has no more members.
Done.
robot@raspberrypi:~ $
</code></pre><h2 id=authorise-public-key-for-that-user>Authorise public key for that user</h2><pre><code>$ ssh-copy-id -i ./rpi-key.pub robot@raspberrypi.myhomedomain
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;./rpi-key.pub&quot;
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
robot@raspberrypi.myhomedomain's password:

Number of key(s) added:        1

Now try logging into the machine, with:   &quot;ssh 'robot@raspberrypi.myhomedomain'&quot;
and check to make sure that only the key(s) you wanted were added.

$ ssh robot@raspberrypi.myhomedomain -i ./rpi-key
Linux raspberrypi 5.4.83+ #1379 Mon Dec 14 13:06:05 GMT 2020 armv6l

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
robot@raspberrypi:~ $
</code></pre><h2 id=set-hostname>Set hostname</h2><pre><code>robot@raspberrypi:~ $ echo &quot;mon-livingroom&quot; | sudo tee /etc/hostname
mon-livingroom

robot@raspberrypi:~ $ sudo sed -i 's/raspberrypi/mon-livingroom/g' /etc/hosts

robot@raspberrypi:~ $ sudo reboot

$ ssh robot@mon-livingroom.myhomedomain -i ./rpi-key
The authenticity of host 'mon-livingroom.myhomedomain (172.80.43.99)' can't be established.
ECDSA key fingerprint is SHA256:6ryJBtgVc3k1liVATeBBXnapErFLAArbhVhwoFu7aw0.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added 'mon-livingroom.myhomedomain' (ECDSA) to the list of known hosts.
Linux mon-livingroom 5.4.83+ #1379 Mon Dec 14 13:06:05 GMT 2020 armv6l

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Fri Mar 26 22:05:57 2021 from 172.80.41.127
robot@mon-livingroom:~ $
</code></pre><p>To be continued&mldr;</p><ul class=pa0></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-near-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://dev.kem.li>&copy; Andrew Kember 2021</a><div><a href=https://twitter.com/andrewkember target=_blank class="link-transition twitter link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://www.linkedin.com/in/andrewkember/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://github.com/andrewkember target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></footer><script src=/dist/js/app.3fc0f988d21662902933.js></script></body></html>